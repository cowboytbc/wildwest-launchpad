<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet Debug - WILDWEST</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #00eaff;
      padding: 20px;
      line-height: 1.6;
    }
    .debug-section {
      background: #2a2a2a;
      border: 1px solid #00eaff;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .debug-section h3 {
      color: #ffffff;
      margin-top: 0;
    }
    .status {
      background: #333;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    button {
      background: linear-gradient(45deg, #00eaff, #0066cc);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    button:hover {
      background: linear-gradient(45deg, #0066cc, #004499);
    }
    .error { color: #ff4444; }
    .success { color: #44ff44; }
    .warning { color: #ffaa44; }
  </style>
</head>
<body>
  <h1>🔍 WILDWEST Wallet Connection Debug</h1>
  
  <div class="debug-section">
    <h3>📋 System Status</h3>
    <div class="status" id="systemStatus">Loading...</div>
  </div>
  
  <div class="debug-section">
    <h3>🦊 Ethereum Wallets</h3>
    <div class="status" id="ethereumWallets">Scanning...</div>
    <button onclick="testEthereumConnection()">Test Ethereum Connection</button>
  </div>
  
  <div class="debug-section">
    <h3>🟣 Solana Wallets</h3>
    <div class="status" id="solanaWallets">Scanning...</div>
    <button onclick="testSolanaConnection()">Test Solana Connection</button>
  </div>
  
  <div class="debug-section">
    <h3>🔄 Connection Tests</h3>
    <div class="status" id="connectionResults">No tests run yet</div>
    <button onclick="runFullDiagnostic()">Run Full Diagnostic</button>
    <button onclick="clearResults()">Clear Results</button>
  </div>

  <!-- Load all the same scripts as the main site -->
  <script src="js/console-filter.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="js/production-config.js"></script>
  <script src="js/rpc-config.js"></script>
  <script src="js/multi-wallet-manager.js"></script>
  <script src="js/wallet.js"></script>
  <!-- Unified wallet connection system (fixes all connection issues) -->
  <script src="js/unified-wallet-connection.js"></script>
  <script src="https://unpkg.com/@solana/web3.js@1.93.2/lib/index.iife.js"></script>

  <script>
    let debugLog = [];
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const entry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
      debugLog.push(entry);
      console.log(entry);
      
      // Update connection results if that's what we're logging to
      if (document.getElementById('connectionResults')) {
        document.getElementById('connectionResults').textContent = debugLog.slice(-10).join('\n');
      }
    }
    
    // System status check
    function checkSystemStatus() {
      const status = [];
      
      status.push(`🌐 User Agent: ${navigator.userAgent}`);
      status.push(`📱 Mobile: ${/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}`);
      status.push(`🪟 Window objects available:`);
      status.push(`  - ethereum: ${!!window.ethereum}`);
      status.push(`  - solana: ${!!window.solana}`);
      status.push(`  - wildWestWallet: ${!!window.wildWestWallet}`);
      status.push(`  - multiWalletManager: ${!!window.multiWalletManager}`);
      status.push(`  - ethers: ${!!window.ethers}`);
      status.push(`  - solanaWeb3: ${!!window.solanaWeb3}`);
      
      if (window.PRODUCTION_CONFIG) {
        status.push(`🔐 Production Config: ${window.PRODUCTION_CONFIG.source}`);
        status.push(`  - Solana RPC: ${window.PRODUCTION_CONFIG.rpc.solana || 'null'}`);
        status.push(`  - Base RPC: ${window.PRODUCTION_CONFIG.rpc.base || 'null'}`);
      }
      
      document.getElementById('systemStatus').textContent = status.join('\n');
    }
    
    // Ethereum wallet detection
    function checkEthereumWallets() {
      const results = [];
      
      if (!window.ethereum) {
        results.push('❌ No window.ethereum detected');
        document.getElementById('ethereumWallets').textContent = results.join('\n');
        return;
      }
      
      results.push('✅ window.ethereum exists');
      
      // Check for multiple providers
      if (window.ethereum.providers) {
        results.push(`🔍 Multiple providers: ${window.ethereum.providers.length}`);
        window.ethereum.providers.forEach((provider, index) => {
          results.push(`  Provider ${index}:`);
          results.push(`    - MetaMask: ${!!provider.isMetaMask}`);
          results.push(`    - Coinbase: ${!!provider.isCoinbaseWallet}`);
          results.push(`    - Phantom: ${!!provider.isPhantom}`);
        });
      } else {
        results.push('Single provider detected:');
        results.push(`  - MetaMask: ${!!window.ethereum.isMetaMask}`);
        results.push(`  - Coinbase: ${!!window.ethereum.isCoinbaseWallet}`);
        results.push(`  - Phantom: ${!!window.ethereum.isPhantom}`);
      }
      
      // Test wildWestWallet detection
      if (window.wildWestWallet) {
        try {
          const detectedWallets = window.wildWestWallet.detectEVMWallets();
          results.push(`🔍 WildWest detected EVM wallets: ${detectedWallets.length}`);
          detectedWallets.forEach(wallet => {
            results.push(`  - ${wallet.icon} ${wallet.name} (Mobile: ${wallet.mobile})`);
          });
        } catch (error) {
          results.push(`❌ Error detecting EVM wallets: ${error.message}`);
        }
      }
      
      document.getElementById('ethereumWallets').textContent = results.join('\n');
    }
    
    // Solana wallet detection
    function checkSolanaWallets() {
      const results = [];
      
      if (!window.solana) {
        results.push('❌ No window.solana detected');
        document.getElementById('solanaWallets').textContent = results.join('\n');
        return;
      }
      
      results.push('✅ window.solana exists');
      results.push(`  - Phantom: ${!!window.solana.isPhantom}`);
      results.push(`  - Connected: ${!!window.solana.isConnected}`);
      
      // Check for multiple providers
      if (window.solana.providers) {
        results.push(`🔍 Multiple providers: ${window.solana.providers.length}`);
      }
      
      // Check other Solana wallets
      const otherWallets = [];
      if (window.phantom) otherWallets.push('Phantom (window.phantom)');
      if (window.solflare) otherWallets.push('Solflare');
      if (window.slope) otherWallets.push('Slope');
      if (window.glow) otherWallets.push('Glow');
      if (window.backpack) otherWallets.push('Backpack');
      
      if (otherWallets.length > 0) {
        results.push('🔍 Other Solana wallets found:');
        otherWallets.forEach(wallet => results.push(`  - ${wallet}`));
      }
      
      // Test wildWestWallet detection
      if (window.wildWestWallet) {
        try {
          const detectedWallets = window.wildWestWallet.detectSolanaWallets();
          results.push(`🔍 WildWest detected Solana wallets: ${detectedWallets.length}`);
          detectedWallets.forEach(wallet => {
            results.push(`  - ${wallet.icon} ${wallet.name} (Mobile: ${wallet.mobile})`);
          });
        } catch (error) {
          results.push(`❌ Error detecting Solana wallets: ${error.message}`);
        }
      }
      
      document.getElementById('solanaWallets').textContent = results.join('\n');
    }
    
    // Test Ethereum connection
    async function testEthereumConnection() {
      log('🔵 Testing Ethereum connection...', 'info');
      
      try {
        if (!window.wildWestWallet) {
          throw new Error('wildWestWallet not available');
        }
        
        log('🔵 Calling connectBaseWallet()...', 'info');
        const result = await window.wildWestWallet.connectBaseWallet();
        
        if (result) {
          log(`✅ Ethereum connection successful!`, 'success');
          log(`📍 Account: ${window.wildWestWallet.account}`, 'success');
          log(`🔗 Chain: ${window.wildWestWallet.currentChain}`, 'success');
        } else {
          log(`❌ Ethereum connection failed`, 'error');
        }
      } catch (error) {
        log(`❌ Ethereum connection error: ${error.message}`, 'error');
      }
    }
    
    // Test Solana connection
    async function testSolanaConnection() {
      log('🟣 Testing Solana connection...', 'info');
      
      try {
        if (!window.wildWestWallet) {
          throw new Error('wildWestWallet not available');
        }
        
        log('🟣 Calling connectSolanaWallet()...', 'info');
        const result = await window.wildWestWallet.connectSolanaWallet();
        
        if (result) {
          log(`✅ Solana connection successful!`, 'success');
          log(`📍 Account: ${window.wildWestWallet.account}`, 'success');
          log(`🔗 Chain: ${window.wildWestWallet.currentChain}`, 'success');
        } else {
          log(`❌ Solana connection failed`, 'error');
        }
      } catch (error) {
        log(`❌ Solana connection error: ${error.message}`, 'error');
      }
    }
    
    // Run full diagnostic
    async function runFullDiagnostic() {
      log('🔍 Starting full wallet diagnostic...', 'info');
      
      // Check system
      checkSystemStatus();
      checkEthereumWallets();
      checkSolanaWallets();
      
      // Test connections (one at a time)
      await new Promise(resolve => setTimeout(resolve, 1000));
      log('🧪 Testing wallet connections...', 'info');
      
      // Test specific chain connections
      try {
        if (window.wildWestWallet) {
          log('🔍 Testing connectToSpecificChain("solana")...', 'info');
          const solanaResult = await window.wildWestWallet.connectToSpecificChain('solana');
          log(`🟣 Solana specific chain result: ${solanaResult}`, solanaResult ? 'success' : 'error');
          
          await new Promise(resolve => setTimeout(resolve, 2000));
          
          log('🔍 Testing connectToSpecificChain("base")...', 'info');
          const baseResult = await window.wildWestWallet.connectToSpecificChain('base');
          log(`🔵 Base specific chain result: ${baseResult}`, baseResult ? 'success' : 'error');
        }
      } catch (error) {
        log(`❌ Diagnostic error: ${error.message}`, 'error');
      }
      
      log('🏁 Diagnostic complete!', 'info');
    }
    
    function clearResults() {
      debugLog = [];
      document.getElementById('connectionResults').textContent = 'Results cleared';
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        checkSystemStatus();
        checkEthereumWallets();
        checkSolanaWallets();
        log('📋 Debug page loaded successfully', 'info');
      }, 1000); // Give scripts time to load
    });
  </script>
</body>
</html>
