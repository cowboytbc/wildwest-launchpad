<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîß WILDWEST Wallet Issue Diagnostics</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #00eaff;
      padding: 20px;
      line-height: 1.6;
    }
    .test-section {
      background: #2a2a2a;
      border: 1px solid #00eaff;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .test-section h3 {
      color: #ffffff;
      margin-top: 0;
    }
    .status {
      background: #333;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
    button {
      background: linear-gradient(45deg, #00eaff, #0066cc);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    button:hover {
      background: linear-gradient(45deg, #0066cc, #004499);
    }
    .error { color: #ff4444; }
    .success { color: #44ff44; }
    .warning { color: #ffaa44; }
    .issue-report {
      background: #3a1f1f;
      border: 1px solid #ff4444;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <h1>üîß WILDWEST Wallet Issue Diagnostics</h1>
  
  <div class="issue-report">
    <h3>üö® Report Issues Found:</h3>
    <p><strong>Please tell me specifically what you're seeing:</strong></p>
    <ul>
      <li>Which page(s) have problems? (index, solana-locking, base-locking, etc.)</li>
      <li>What happens when you click "Connect Wallet"? (nothing, error, wrong wallet, etc.)</li>
      <li>What browser and wallet are you using? (Chrome + MetaMask, mobile Phantom, etc.)</li>
      <li>Are there any error messages in the browser console? (press F12 ‚Üí Console tab)</li>
    </ul>
  </div>
  
  <div class="test-section">
    <h3>üìã Quick System Check</h3>
    <div class="status" id="systemCheck">Checking...</div>
    <button onclick="runSystemCheck()">Re-run System Check</button>
  </div>
  
  <div class="test-section">
    <h3>ü¶ä Wallet Detection Test</h3>
    <div class="status" id="walletDetection">Testing...</div>
    <button onclick="testWalletDetection()">Test Wallet Detection</button>
  </div>
  
  <div class="test-section">
    <h3>üîÑ Connection Test</h3>
    <div class="status" id="connectionTest">Ready to test</div>
    <button onclick="testSolanaConnection()">Test Solana Connection</button>
    <button onclick="testBaseConnection()">Test Base Connection</button>
    <button onclick="testUnifiedConnection()">Test Unified System</button>
  </div>
  
  <div class="test-section">
    <h3>üîç Error Log</h3>
    <div class="status" id="errorLog">No errors yet</div>
    <button onclick="clearErrorLog()">Clear Log</button>
  </div>

  <!-- Load all wallet scripts -->
  <script src="js/console-filter.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="js/production-config.js"></script>
  <script src="js/rpc-config.js"></script>
  <script src="js/multi-wallet-manager.js"></script>
  <script src="js/wallet.js"></script>
  <script src="js/unified-wallet-connection.js"></script>
  <script src="https://unpkg.com/@solana/web3.js@1.93.2/lib/index.iife.js"></script>

  <script>
    let errorLog = [];
    
    // Capture all console errors
    const originalError = console.error;
    console.error = function(...args) {
      errorLog.push(`[${new Date().toLocaleTimeString()}] ERROR: ${args.join(' ')}`);
      updateErrorLog();
      originalError.apply(console, args);
    };
    
    const originalWarn = console.warn;
    console.warn = function(...args) {
      errorLog.push(`[${new Date().toLocaleTimeString()}] WARN: ${args.join(' ')}`);
      updateErrorLog();
      originalWarn.apply(console, args);
    };
    
    function updateErrorLog() {
      document.getElementById('errorLog').textContent = errorLog.slice(-10).join('\n') || 'No errors logged';
    }
    
    function clearErrorLog() {
      errorLog = [];
      updateErrorLog();
    }
    
    function runSystemCheck() {
      const checks = [];
      
      checks.push('üåê Browser: ' + navigator.userAgent.split(')')[0] + ')');
      checks.push('üì± Mobile: ' + (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)));
      checks.push('ü™ü window.ethereum: ' + !!window.ethereum);
      checks.push('üü£ window.solana: ' + !!window.solana);
      checks.push('üéØ wildWestWallet: ' + !!window.wildWestWallet);
      checks.push('üîß multiWalletManager: ' + !!window.multiWalletManager);
      checks.push('üîó unifiedWalletConnection: ' + !!window.unifiedWalletConnection);
      checks.push('üí∞ ethers: ' + !!window.ethers);
      checks.push('üåä solanaWeb3: ' + !!window.solanaWeb3);
      
      if (window.PRODUCTION_CONFIG) {
        checks.push('üîê Production Config: ' + window.PRODUCTION_CONFIG.source);
        checks.push('  Solana RPC: ' + (window.PRODUCTION_CONFIG.rpc.solana ? '‚úÖ Available' : '‚ùå NULL'));
        checks.push('  Base RPC: ' + (window.PRODUCTION_CONFIG.rpc.base ? '‚úÖ Available' : '‚ùå NULL'));
      } else {
        checks.push('‚ùå No PRODUCTION_CONFIG found');
      }
      
      if (window.RPC_CONFIG) {
        const solanaEndpoint = window.RPC_CONFIG.getSolanaEndpoint();
        const baseEndpoint = window.RPC_CONFIG.getBaseEndpoint();
        checks.push('üîó Solana Endpoint: ' + solanaEndpoint);
        checks.push('üîó Base Endpoint: ' + baseEndpoint);
      }
      
      document.getElementById('systemCheck').textContent = checks.join('\n');
    }
    
    function testWalletDetection() {
      const results = [];
      
      try {
        if (window.wildWestWallet) {
          // Test Solana wallet detection
          const solanaWallets = window.wildWestWallet.detectSolanaWallets();
          results.push(`üü£ Solana wallets detected: ${solanaWallets.length}`);
          solanaWallets.forEach(wallet => {
            results.push(`  - ${wallet.icon} ${wallet.name} (Mobile: ${wallet.mobile})`);
          });
          
          // Test EVM wallet detection
          const evmWallets = window.wildWestWallet.detectEVMWallets();
          results.push(`ü¶ä EVM wallets detected: ${evmWallets.length}`);
          evmWallets.forEach(wallet => {
            results.push(`  - ${wallet.icon} ${wallet.name} (Mobile: ${wallet.mobile})`);
          });
        } else {
          results.push('‚ùå wildWestWallet not available');
        }
        
        if (window.multiWalletManager) {
          results.push('‚úÖ Multi-wallet manager active');
          results.push(`üìä Detected wallets:`);
          results.push(`  - Ethereum: ${window.multiWalletManager.detectedWallets?.ethereum?.length || 0}`);
          results.push(`  - Solana: ${window.multiWalletManager.detectedWallets?.solana?.length || 0}`);
        } else {
          results.push('‚ùå Multi-wallet manager not available');
        }
        
      } catch (error) {
        results.push(`‚ùå Error during wallet detection: ${error.message}`);
      }
      
      document.getElementById('walletDetection').textContent = results.join('\n');
    }
    
    async function testSolanaConnection() {
      const results = [`üü£ Testing Solana connection...`];
      document.getElementById('connectionTest').textContent = results.join('\n');
      
      try {
        if (!window.wildWestWallet) {
          throw new Error('wildWestWallet not available');
        }
        
        results.push('üîÑ Calling connectSolanaWallet()...');
        document.getElementById('connectionTest').textContent = results.join('\n');
        
        const connected = await window.wildWestWallet.connectSolanaWallet();
        
        if (connected) {
          results.push('‚úÖ Solana connection successful!');
          results.push(`üìç Account: ${window.wildWestWallet.account}`);
          results.push(`üîó Chain: ${window.wildWestWallet.currentChain}`);
        } else {
          results.push('‚ùå Solana connection failed');
        }
        
      } catch (error) {
        results.push(`‚ùå Error: ${error.message}`);
      }
      
      document.getElementById('connectionTest').textContent = results.join('\n');
    }
    
    async function testBaseConnection() {
      const results = [`üîµ Testing Base connection...`];
      document.getElementById('connectionTest').textContent = results.join('\n');
      
      try {
        if (!window.wildWestWallet) {
          throw new Error('wildWestWallet not available');
        }
        
        results.push('üîÑ Calling connectBaseWallet()...');
        document.getElementById('connectionTest').textContent = results.join('\n');
        
        const connected = await window.wildWestWallet.connectBaseWallet();
        
        if (connected) {
          results.push('‚úÖ Base connection successful!');
          results.push(`üìç Account: ${window.wildWestWallet.account}`);
          results.push(`üîó Chain: ${window.wildWestWallet.currentChain}`);
        } else {
          results.push('‚ùå Base connection failed');
        }
        
      } catch (error) {
        results.push(`‚ùå Error: ${error.message}`);
      }
      
      document.getElementById('connectionTest').textContent = results.join('\n');
    }
    
    async function testUnifiedConnection() {
      const results = [`üîß Testing Unified connection system...`];
      document.getElementById('connectionTest').textContent = results.join('\n');
      
      try {
        if (!window.unifiedWalletConnection) {
          throw new Error('unifiedWalletConnection not available');
        }
        
        results.push('üîÑ Testing unified connect system...');
        document.getElementById('connectionTest').textContent = results.join('\n');
        
        // Test with no preferred chain (should show selection)
        const connected = await window.unifiedWalletConnection.unifiedConnect();
        
        if (connected) {
          results.push('‚úÖ Unified connection successful!');
          results.push(`üìç Account: ${window.wildWestWallet.account}`);
          results.push(`üîó Chain: ${window.wildWestWallet.currentChain}`);
        } else {
          results.push('‚ùå Unified connection failed or cancelled');
        }
        
      } catch (error) {
        results.push(`‚ùå Error: ${error.message}`);
      }
      
      document.getElementById('connectionTest').textContent = results.join('\n');
    }
    
    // Auto-run system check on load
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        runSystemCheck();
        testWalletDetection();
      }, 1000);
    });
  </script>
</body>
</html>
